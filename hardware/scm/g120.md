# G120
---

![G120 / G120E](images/g120-noborder.jpg)

# Introduction

The G120 SoMs are powerful, low-cost, surface-mount System on Modules (SoM) running Microsoft's .NET Micro
Framework. The .NET Micro Framework enables the SoM to be programmed from Microsoft Visual Studio using a
USB or serial cable. Programming in a modern managed language, such as C# or Visual Basic, allows developers to
accomplish more work in less time by taking advantage of the extensive built-in libraries for networking, file
systems, graphical interfaces, and more.
A simple two-layer circuit board with a power source and a few connectors can utilize the G120 SoMs to bring the
latest technologies to any product. There are no additional licensing or other fees and all the development tools
are provided freely.

## G120 vs G120E

|                    | G120                               |G120E                          |
|--------------------|------------------------------------|-------------------------------|
| Processor          | NXP LPC1788FET 180                 | NXP LPC1788FET208             |
| Package            | 91 pin surface-mount module (SMT)  | 120 MHz                       |
| Dimensions         | 38.1 x 26.7 x 3.5 mm               |45.8 x 39.4 x 4.4 mm           |
| RTC                | External 32,768 Hz crystal         | Included                      |
| GPIO               | 72                                 | 80                            |
| SPI                | 3                                  | 2                             |
| Ethernet           | ENC28J60 over SPI                  | ENC28J60 over SPI and/or      |
|                    |                                    |Built-in base 100 Ethernet PHY |

Pricing, purchasing and other information can be found on the [G120 Page](http://www.ghielectronics.com/products/scm/g120) on our main website.

# Getting Started

Options for programming the G120 include the following:

## TinyCLR OS
TinyCLR provides a way to program the G120 in C# or Visual Basic using Microsoft Visual Studio.  To get started you must first install the bootloader and firmware on the G120 (instructions below) and then go to the TinyCLR [Getting Started](../../software/tinyclr/getting-started.md) page for instructions on setting up the host computer and writing and deploying programs.

## Microsoft's .NET Micro Framework (NETMF)
For more information on NETMF you can go to the [NETMF Introduction](../../software/netmf/intro.md) page.  The [NETMF Getting Started](../../software/netmf/getting-started.md) page covers NETMF from setup of the host computer to program deployment on both an emulator and target device.

## Loading Bootloader v2
The G120 comes with Bootloader v1 pre-installed. To upgrade to Bootloader v2, follow the instructions on our [Upgrading GHI Bootloader v1 to v2](../../software/loaders/upgrading-v1-to-v2.md) page. To put the G120 into boot mode, set the LDR0 and LDR1 signals low and reset the board. You may have to wait a couple of seconds before releasing LDR0 and LDR1.

## Loading the Firmware

> [!Tip]
> First make sure you have bootloader v2 loaded. This needs to be done only once.

To activate bootloader v2, hold the LDR0 signal low while resetting the board.

Download the [G120 firmware](../../software/tinyclr/downloads.md#g120) and follow [Loading the Firmware](../../software/loaders/ghi-bootloader.md#loading-the-firmware) steps.
#### Using Native Code with TinyCLR
TinyCLR OS also lets you use native code that that works alongside your managed application. Native code can be used to provide improved performance or access to advanced features not exposed through TinyCLR. For more information check out [Native Code on TinyCLR](../../software/tinyclr/native/intro.md).

TinyCLR cannot relocate native code, so you will have specify its location in the scatterfile. For the G120, the interop region starts at address 0xA0F00000, and its length is 0xFFF8.

# Specifications

| Spec               | Value                     |
|--------------------|---------------------------|
| Processor          | NXP LPC1788FET            |
| Speed              | 120 MHz                   |
| Internal RAM       | 96 KByte (SRAM)           |
| Internal Flash     | 512 KByte                 |
| External RAM       | 16 MByte (DRAM)           |
| External Flash     | 4 MByte (SPI)             |
| Dimensions (G120)  | 38.1 x 26.7 x 3.5 mm      |
| Dimensions (G120E) | 45.8 x 39.4 x 4.4 mm      |

*Note: Not all memory will be available for your application.*

## G120 Pinout

[![G120 Pinout](images/g120-pinout.png)](/Documents/Pinouts/g120.pdf)  

## G120E Pinout

[![G120E Pinout](images/g120e-pinout.png)](/Documents/Pinouts/g120e-pinout.pdf)

## Footprints

We recommend no traces or vias under the module. Dimensions are in inches.#### G120 Recommended Footprint

![G120 Pinout](images/g120-footprint.jpg)

#### G120E Recommended Footprint

![G120 Pinout](images/g120e-footprint.jpg)

## G120 Development Board

The G120E Dev Board is an excellent starting point and reference design for anyone interested in evaluating and
developing with the G120

![G120 Dev Board](images/g120dev.jpg) 

The development system used for evaluating the G120 SoM.

* [Schematic](http://files.ghielectronics.com/downloads/Schematics/Systems/G120E%20Dev%20Board%20Schematic.pdf)



# Device Startup

The G120 is held in reset when the reset pin is low. Releasing it will begin the system startup process. It is pulled
high internally on the G120E and left floating on the G120

There are four different components of the device firmware:

1. GHI Bootloader: initializes the system, updates TinyBooter when needed, and executes TinyBooter.
2. TinyBooter: executes TinyCLR, updates TinyCLR when needed, and updates the system configuration.
3. TinyCLR: loads, debugs, and executes the managed application.
4. Managed application: the program developed by the customer.

Which components get executed on startup can be control by manipulating the LDR0 and LDR1 pins. LDR0 and
LDR1 are pulled high on startup.


| LDRO               | LDR1                      | Effect                          |  
|--------------------|---------------------------|---------------------------------|
| Ignored            | High                      | Excecute the managed application|
| High               | Low                       | Wait in TinyBooter              |
| Low                | Low                       | Wait in GHI Bootloader          |

Additionally, the communications interface between the host PC and the G120 is selected on startup through the
MODE pin, which is pulled high on startup.

| MODE               | G120                      | G120E                           |  
|--------------------|---------------------------|---------------------------------|
| High               | USB                       | COM1                            |
| Low                | COM1                      | USB                             |

The above discussed functions of LDR0, LDR1, and MODE are only during startup. After startup, they return to the
default GPIO state and are available to use as GPIO in the user application.

# Libraries

## (GPIO) General Purpose Input and Output

GPIOs can read and write logical high and low signals. Keep the following in mind:

* They default to inputs with internal weak pull-up resistors
* They operate on 3.3 V logic levels.
* They are 5 V tolerant when not in analog mode.
* They have controllable pull up and pull down resistors.
* Only pins on ports 0 and 2 are interrupt capable
* Individual pins can source or sink up to 4 mA (see the processor’s documentation for advanced
information).## Analog InputAnalog inputs can read voltages from 0 V to 3.3 V with 12-bit resolution. The built in analog circuitry uses the
source voltage as a reference which can cause some noise on the analog signal. High accuracy ADCs with a
dedicated reference can be added externally.## Analog OutputAnalog outputs can vary their voltage from 0 V to 3.3 V with 10-bit resolution. The output voltage is meant to be
used as a signal and not a driver. An op-amp or similar circuit can be used to amplify the current. ## (PWM) Pulse Width ModulationPWM is used to create a waveform with a specified frequency and duty cycle. It uses built-in hardware so no
processing resources are needed to keep it running. Frequencies can range from 1 Hz to 30 MHz.
Some PWM channels share the same source clock internally. Changing the frequency on a channel will affect other
channels; however, they can have a separate duty cycle.
| Channel            | Timer                     | 
|--------------------|---------------------------|
| 0 to 5             | 0                         |
| 6 to 11            | 1                         |

## Signal Generator

Signal Generator is used to generate a waveform on any GPIO with varying frequency and duty cycle. The feature is
software driven and can generate frequencies up to 40 kHz ±10%. More processing time is required for higher
frequencies.

## Signal Capture

Signal Capture monitors any GPIO and records the time from the last change. This feature is software driven and
can measure frequencies up to 100 kHz ±10%. Lower frequencies have higher accuracy.
## Pulse Feedback

Pulse Feedback is used for sensing capacitance on any GPIO input and measuring pulses from ultrasonic distance
and other sensors. When used for sensing capacitance, a 100 pF capacitor and 1 resistor between the pad and
ground are recommended.

## (UART) Universal Asynchronous Receiver Transmitter

UART is a common, full duplex, communications interface. Baud rates from 1,200 to 921,600 are supported.
Handshaking is supported on COM2 only. Data bits between 5 and 8 are supported. Stop bits of 1 and 2 are
supported, 2 stop bits are not supported with five data bits. Space, mark, even, and odd parities are supported.

## (SPI) Serial Peripheral Interface

SPI is a common three or four wire serial interface. The G120 can act as a SPI bus master only. The maximum
supported clock is 30 MHz and all four SPI modes are supported. The SPI bus is designed to interface with multiple
SPI slave devices. The active slave is selected by asserting the chip select line on the slave device.
SPI2 is shared internally with the flash memory on the G120. Use of a chip select with devices on this channel is
required or the G120 will not function properly. The use of another SPI channel is recommended.

## (I2C) Inter-Integrated Circuit

I2C is a two-wire addressable serial interface. The G120 can act as an I2C bus master only with 7-bit slave
addresses. It can connect to one or more slave devices over the same connection with a maximum clock of 400
kHz. The I2C bus interface requires pull up resistors to be added on both the SCL and SDA pins, usually 2.2 kΩ.
It is possible to simulate an independent I2C bus on any two GPIO pins with the appropriate resistors though the
software I2C class, but performance will be lower.
## (CAN) Controller Area Network

CAN is a common interface in industrial control and the automotive industry. CAN on the G120 is compliant with
the CAN 2.0B specifications. Bitrates up to 1 Mbit/s are supported. For systems with higher traffic, different
message filter options are available.

#### CAN Bit Timing Settings

The following CAN bit timing paramaters were calculated for a G120 driving the SN65HVD230 CAN driver chip. See the [Configuring the Bus](../../software/tinyclr/tutorials/can.md#configuring-the-bus) section of the [CAN Tutorial](../../software/tinyclr/tutorials/can.md) for more information.

| Baud | Propagation | Phase1 | Phase2 | Baudrate Prescaler | Synchronization Jump Width | Use Multi Bit Sampling | Sample Point | Max Osc. Tolerance | Max Cable Length
|---|---|---|---|---|---|---|---|---|---
| 33.333K | 1 | 12 | 2 | 120 | 1 | False | 86.7% | 0.33% | 2145M
| 83.333K | 1 | 13 | 2 | 45  | 1 | False | 87.5% | 0.31% | 845M
| 125K    | 1 | 13 | 2 | 30  | 1 | False | 87.5% | 0.31% | 545M
| 250K    | 1 | 13 | 2 | 15  | 1 | False | 87.5% | 0.31% | 245M
| 500K    | 1 | 12 | 2 | 8   | 1 | False | 86.7% | 0.33% | 92M
| 1M      | 1 | 12 | 2 | 4   | 1 | False | 86.7% | 0.33% | 18M

*Note: Maximum Oscillator Tolerance and Maximum Cable Length are theoretical maximums and must be tested to ensure reliability.*

## 1-Wire

Through 1-Wire, a master can communicate with multiple 1-Wire slaves using any GPIO.
## Graphics

The G120 supports 16-bit color TFT displays up to 800x600. Displays require the horizontal sync, vertical sync,
clock, enable, and the 16 color lines. The color format is 565 (5 bits for red, 6 bits for green, and 5 bits for blue). If the display has more than 16 color lines, connect the most significant color lines to the G120 and the remaining
lines to ground.
While SPI displays can be utilized as well, the native TFT interface is recommended as it allows for a faster update
rate.
NETMF includes support for drawing though the bitmap object. TrueType font files can be used once converted to
the TinyFont format used by NETMF.

## Touch Screen

The G120 supports displays with four-wire restive touch without the need for any additional hardware, though
using an external controller is possible. The default touch pins can be remapped if required. Capacitive touch
displays can be used through the I2C interface.
## USB Host

USB host allows the use of USB mass storage devices, joysticks, keyboards, and mice. Additionally, for USB devices
that do not have a standard class included, low level USB access is provided for bulk transfers. USB hubs are
supported allowing multiple devices to be connected. 

## USB Client

The USB client interface is typically used as the G120 debug interface and for application deployment through
Visual Studio. However, it is controllable and may be used to simulate other USB devices such as mice, keyboards,
and Communications Device Class (CDC) interfaces using low level access instead of the debug interface.
## File System

The G120 supports accessing files on SD cards and USB memory devices formatted as FAT16 or FAT32. SD cards
use a true 4-bit interface. MMC/SD/SDHC/SDXC cards in full, mini, and micro formats and any USB device with
mass storage class are supported. Access speeds are dependent on many different factors and can be up to 500
Kbyte/s.

## Networking

The G120 supports Ethernet, Wi-Fi, and PPP. The full stack includes TCP, UDP, DHCP, DNS, HTTP, FTP, and others.
Secure connections can be created using the built in SSL stack.

#### Ethernet

Ethernet support is available using the built-in NETMF TCP/IP and SSL stack through the on-board base-100
Ethernet PHY on the G120E and through an external ENC28J60 SPI Ethernet chip on both the G120 and the G120E.

#### WiFi

Any Wi-Fi module with a built-in TCP/IP stack can be used with the G120. However, these modules are typically
limited. Through the supported Redpine RS9110-N-11-22-04 and RS9110-N-11-22-05 chips, Wi-Fi is usable with the
built-in NETMF TCP/IP and SSL stacks.

#### Point to Point

The Point to Point (PPP) protocol is often used for devices needing to connect to mobile networks. While typical
embedded devices use the mobile modem's built-in and very limited TCP/IP stack, systems using the G120 can use
these modems with the internal NETMF TCP/IP and SSL stack.

## Extended Weak References

Extended Weak References are a way for managed applications to store data in non-volatile memory. This is meant
to be used as a configuration store that does not change frequently where the data can be recreated if needed.
There are 128 KBytes available for use. 
## Configuration

Access to the configuration sector of the device is provided for storage of small, infrequently changing, entries. The
data will be lost if the configuration is reflashed. Space is limited and varies based on other information stored in
the configuration.

## Real Time Clock

The real time clock (RTC) is used to keep time while the processor is off, drawing its power from a 3 V backup
battery or super capacitor providing 3 V. An appropriate 32,768 Hz crystal and its associated circuitry must be
connected to the G120 for the RTC to function. It is included on the G120E. 

## Watchdog

Watchdog is used to reset the system if it enters an erroneous state. The G120 supports timeouts between 1 ms
and 134,217 ms. Watchdog support is included through the GHI Electronics libraries replacing the built in NETMF
version. 

## Power Control

The G120 supports entering sleep, deep sleep, and off modes in order to reduce power usage. It can consume as
little as 120 mA in sleep, 18 mA in deep sleep, and 12 mA in off. It may be woken from an RTC alarm or a GPIO
interrupt. Sleep pauses execution of the program. Deep sleep pauses execution of the program and shuts down
many internal functions. Off shuts down all internal functions and can only be woken by the RTC alarm or a system
reset. The system will be automatically reset when exiting off mode.
## In-Field Update

Through In-Field Update, the G120 can update its firmware and managed application. The update can come from
the network, a bus, or connected media. 

## SQLite Database

SQLite can be used to created databases that can be stored in memory or on a supported storage device such as a
USB drive or SD card.

## Direct Memory Access
Low level device registers and memory can be accessed to further configure the G120’s underlying processor. Not
all functionality of the processor is available as some functions may be used or configured internally for use in
NETMF. 

## Battery RAM

Battery-backed RAM is provided as part of the internal RTC. This memory retains its contents when the power is
lost as long as there is a backup battery. There are 20 bytes of battery backed RAM available. Consult the
processor's documentation for details on use.

## EEPROM

The G120 has a built-in EEPROM. Consult the processor's documentation for details on use.

## Runtime Loadable Procedures

Similar to code loaded from a DLL, Runtime Loadable Procedures (RLP) allows a binary or ELF image to be loaded
into memory and executed on the device. This is useful for advanced and critical performance scenarios. The RLP
region starts at address 0xA0F00000 and is 0x000FFFFC bytes in size. Your compiled images must fall completely
within that range.

# Design Considerations

## Required Pins

Exposing the following pins is required in every design to enable device programming, updates, and recovery:
* LDR0
* LDR1
* Desired debug interface(s).
* MODE if required to select a debug interface

## Power Supply

A typical clean power source, suited for digital circuitry, is needed to power the G120. Voltages should be within at
least 10% of the needed voltage. Decoupling capacitors of 0.1 μF are needed near every power pin. Additionally, a
large capacitor, typically 47 μF, should be near the G120 if the power supply is more than few inches away.## CrystalsThe G120 and G120E include the needed system crystal and its associated circuitry. The G120E additionally
includes the RTC crystal and its associated circuitry. However, the G120 does not. It requires an external 32,768 Hz
crystal and circuitry for the RTC to function. Please see the processor’s documentation for advanced information.## Interrupt PinsOnly pins on ports 0 and 2 support interrupts.## ResetThe G120E includes an internal pull-up resistor on the reset pin. The G120 does not, so an external 15 kΩ pull-up
resistor is required for correct operation.
## SPI Channels

SPI2 is shared internally with the flash memory on the G120. Use of a chip select with devices on this channel is
required or the G120 will not function properly. The use of another SPI channel is recommended.
## Ethernet

The built in Ethernet available on the G120E includes all needed Ethernet circuitry internally. However, an
appropriate magnet and connector, like the J0011D or similar, are required.

## Direct Memory Access

Most of the core processor’s resources are used by NETMF. Some resources are permanently used, like the main
system timer while others are used when specific features, like the timers for PWM, are enabled. Used resources
can change from one firmware version to another so care must be taken when using these resources through RLP
or other direct memory access methods.

When absolutely required, applications can use resources in conjunction with NETMF. For example, creating a
special baud rate, utilizing the timer capture feature, and making use of many other features supported by the
processor. Please contact GHI Electronics’s consulting services to determine exactly what resources are available
and if the G120 can fulfill the specific requirements.

## Soldering the G120

The G120 is designed to be easily machine-placed or hand-soldered. Static sensitive precautions should be taken
when handling the module.

## Oven Reflow

The G120 is not sealed for moisture. Baking the module before reflow is recommended and required in a humid
environment. The process of reflow can damage the G120 if the temperature is too high or exposure is too long.

The lead-free reflow profile used by GHI Electronics is shown below. The profiles shown are based on SAC 305
solder (3% silver, 0.5% copper). The thermal mass of the assembled board and the sensitivity of the components
on it affect the total dwell time. Differences in the two profiles are where they reach their respective peak
temperatures as well as the time above liquids (TAL). The shorter profile applies to smaller assemblies, whereas
the longer profile applies to larger assemblies such as back-planes or high-density boards. The process window is
described by the shaded area. These profiles are only starting-points and general guidance. The particulars of an
oven and the assembly will determine the final process.

![Reflow Chart](images/reflow-graph.jpg) 

# Legal Notice

## Licensing

The G120 SoM and G120E SoM, with all their built-in software components, are licensed for commercial and noncommercial use. No additional fee or licensing is required. Software, firmware, and libraries provided for the G120
SoM and the G120E SoM are licensed to be used on the G120 SoM and the G120E SoM only.
## Trademarks

G120 and G120E are trademarks of GHI Electronics, LLC.
.NET Micro Framework and Visual Studio are registered or unregistered trademarks of Microsoft Corporation.
Other registered or unregistered trademarks are owned by their respective companies.

## Disclaimer

IN NO EVENT SHALL GHI ELECTRONICS, LLC BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS PRODUCT, EVEN IF ADVISED OF THE POSSIBILITY OF
SUCH DAMAGE. GHI ELECTRONICS, LLC LINE OF PRODUCTS ARE NOT DESIGNED FOR LIFE SUPPORT APPLICATIONS.
SPECIFICATIONS AND AVAILABILITY ARE SUBJECT TO CHANGE WITHOUT ANY NOTICE.

***

TinyCLR lets you program our devices (and others) in C# or Visual Basic using Microsoft's Visual Studio -- and it's all free!  [**Learn more...**](../../software/tinyclr/intro.md).

You can also visit our main website at [**www.ghielectronics.com**](http://www.ghielectronics.com) and our community forums at [**forums.ghielectronics.com**](https://forums.ghielectronics.com/).
